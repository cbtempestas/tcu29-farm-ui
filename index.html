<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TCu29 Farm | Copper-Backed Yield</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(180deg, #f8fafc 0%, #e2e8f0 100%);
            min-height: 100vh;
            color: #1e3a5f;
        }
        .container {
            max-width: 520px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            text-align: center;
            padding: 30px 0 20px;
        }
        .logo {
            width: 80px;
            height: 80px;
            margin: 0 auto 12px;
            object-fit: contain;
        }
        header h1 {
            font-size: 1.8rem;
            margin-bottom: 6px;
            color: #1e3a5f;
        }
        header h1 span {
            color: #b87333;
        }
        header p {
            color: #64748b;
            font-size: 0.9rem;
        }
        .card {
            background: #fff;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            border: 1px solid #e2e8f0;
        }
        .apr-card {
            background: linear-gradient(135deg, #1e3a5f 0%, #2d5a87 100%);
            color: #fff;
            text-align: center;
            padding: 28px 24px;
        }
        .apr-value {
            font-size: 3rem;
            font-weight: 700;
            color: #4ade80;
            line-height: 1;
        }
        .apr-label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
            margin-top: 8px;
        }
        .tvl-row {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid rgba(255, 255, 255, 0.15);
        }
        .tvl-label {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.85rem;
        }
        .tvl-value {
            color: #fff;
            font-weight: 600;
            font-size: 1.1rem;
        }
        .copper-card {
            background: linear-gradient(135deg, #fef3e2 0%, #fde8d0 100%);
            border: 1px solid #f5d5b5;
        }
        .copper-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        .copper-title {
            font-size: 0.85rem;
            font-weight: 600;
            color: #92400e;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .copper-link {
            font-size: 0.8rem;
            color: #b87333;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .copper-link:hover {
            text-decoration: underline;
        }
        .copper-price {
            display: flex;
            align-items: baseline;
            gap: 12px;
            margin-bottom: 12px;
        }
        .copper-price-value {
            font-size: 2rem;
            font-weight: 700;
            color: #1e3a5f;
        }
        .copper-price-change {
            font-size: 0.95rem;
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 20px;
        }
        .copper-price-change.up {
            background: rgba(34, 197, 94, 0.15);
            color: #16a34a;
        }
        .copper-price-change.down {
            background: rgba(239, 68, 68, 0.15);
            color: #dc2626;
        }
        .copper-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid rgba(146, 64, 14, 0.15);
        }
        .copper-stat {
            text-align: center;
        }
        .copper-stat-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e3a5f;
        }
        .copper-stat-label {
            font-size: 0.75rem;
            color: #92400e;
            margin-top: 2px;
        }
        .chart-preview {
            display: block;
            margin-top: 12px;
            border-radius: 8px;
            overflow: hidden;
            background: #fff;
            text-decoration: none;
            position: relative;
            min-height: 80px;
        }
        .chart-preview img {
            width: 100%;
            height: auto;
            display: block;
        }
        .chart-preview .chart-fallback {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 24px;
            gap: 8px;
            color: #b87333;
            font-weight: 500;
        }
        .chart-preview .chart-fallback span:first-child {
            font-size: 2rem;
        }
        .chart-preview .chart-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(184, 115, 51, 0.9));
            color: #fff;
            text-align: center;
            padding: 16px 12px 12px;
            font-weight: 500;
            font-size: 0.9rem;
        }
        .chart-preview:hover .chart-overlay {
            background: linear-gradient(transparent, rgba(184, 115, 51, 1));
        }
        .why-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        .why-item {
            background: #f8fafc;
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            border: 1px solid #e2e8f0;
        }
        .why-icon {
            font-size: 1.5rem;
            margin-bottom: 8px;
        }
        .why-title {
            font-size: 0.85rem;
            font-weight: 600;
            color: #1e3a5f;
            margin-bottom: 4px;
        }
        .why-desc {
            font-size: 0.75rem;
            color: #64748b;
            line-height: 1.4;
        }
        .connect-prompt {
            text-align: center;
            padding: 30px 20px;
        }
        .connect-prompt p {
            color: #64748b;
            margin-bottom: 20px;
            font-size: 0.95rem;
        }
        .btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 12px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #b87333, #cd7f32);
            color: #fff;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(184, 115, 51, 0.4);
        }
        .btn-secondary {
            background: #f1f5f9;
            color: #1e3a5f;
            border: 1px solid #e2e8f0;
        }
        .btn-secondary:hover {
            background: #e2e8f0;
        }
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        .section-title {
            font-size: 0.9rem;
            margin-bottom: 12px;
            color: #1e3a5f;
            font-weight: 600;
        }
        .input-group {
            margin-bottom: 16px;
        }
        .input-wrapper {
            display: flex;
            background: #f8fafc;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #e2e8f0;
        }
        .input-wrapper input {
            flex: 1;
            background: transparent;
            border: none;
            padding: 16px;
            font-size: 1.1rem;
            color: #1e3a5f;
            outline: none;
        }
        .input-wrapper input::placeholder {
            color: #94a3b8;
        }
        .max-btn {
            background: rgba(184, 115, 51, 0.1);
            border: none;
            padding: 16px 20px;
            color: #b87333;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.2s;
        }
        .max-btn:hover {
            background: rgba(184, 115, 51, 0.2);
        }
        .balance-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: #64748b;
            margin-top: 8px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 16px;
        }
        .stat {
            text-align: center;
            padding: 16px;
            background: #f8fafc;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }
        .stat-value {
            font-size: 1.4rem;
            font-weight: 700;
            color: #1e3a5f;
        }
        .stat-label {
            font-size: 0.75rem;
            color: #64748b;
            margin-top: 4px;
        }
        .pending-rewards {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(34, 197, 94, 0.05));
            border: 1px solid rgba(34, 197, 94, 0.2);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            margin-bottom: 16px;
        }
        .pending-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #16a34a;
        }
        .pending-label {
            font-size: 0.85rem;
            color: #64748b;
        }
        .status {
            text-align: center;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 0.9rem;
        }
        .status.success {
            background: rgba(34, 197, 94, 0.1);
            color: #16a34a;
        }
        .status.error {
            background: rgba(239, 68, 68, 0.1);
            color: #dc2626;
        }
        .status.pending {
            background: rgba(184, 115, 51, 0.1);
            color: #b87333;
        }
        .hidden {
            display: none;
        }
        .links {
            display: flex;
            justify-content: center;
            gap: 24px;
            margin-top: 24px;
            flex-wrap: wrap;
        }
        .links a {
            color: #64748b;
            text-decoration: none;
            font-size: 0.85rem;
            transition: color 0.2s;
        }
        .links a:hover {
            color: #b87333;
        }
        .footer {
            text-align: center;
            margin-top: 24px;
            padding-top: 16px;
            border-top: 1px solid #e2e8f0;
        }
        .footer a {
            color: #b87333;
            text-decoration: none;
            font-weight: 500;
            font-size: 0.9rem;
        }
        .footer a:hover {
            text-decoration: underline;
        }
        @media (max-width: 480px) {
            .container {
                padding: 12px;
            }
            .why-section {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <img class="logo" src="https://www.tcu29.io/lovable-uploads/StandingTCu29.png" alt="TCu29">
            <h1>TCu29 <span>Farm</span></h1>
            <p>Stake LP Tokens - Earn Real Yield</p>
        </header>

        <div class="card apr-card">
            <div class="apr-value" id="apr">---%</div>
            <div class="apr-label">Annual Percentage Rate</div>
            <div class="tvl-row">
                <span class="tvl-label">Total Value Locked:</span>
                <span class="tvl-value" id="tvl">$---</span>
            </div>
        </div>

        <div class="card copper-card">
            <div class="copper-header">
                <span class="copper-title">Copper Market</span>
                <a href="https://www.google.com/finance/quote/HGW00:COMEX" target="_blank" class="copper-link">
                    Live Chart
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M7 17L17 7M17 7H7M17 7V17"/>
                    </svg>
                </a>
            </div>
            <div class="copper-price">
                <span class="copper-price-value" id="copper-price">$---.--</span>
                <span class="copper-price-change up" id="copper-change">per lb</span>
            </div>
            <a href="https://www.google.com/finance/quote/HGW00:COMEX?hl=en" target="_blank" class="chart-preview">
                <img src="https://www.gstatic.com/finance/chart/HGW00_COMEX_1Y.png" alt="Copper Price Chart" onerror="this.style.display='none'; this.parentElement.querySelector('.chart-fallback').style.display='flex';">
                <div class="chart-fallback" style="display:none;">
                    <span>ðŸ“ˆ</span>
                    <span>View 1-Year Copper Chart</span>
                </div>
                <div class="chart-overlay">View Live Chart â†’</div>
            </a>
        </div>

        <div class="why-section">
            <div class="why-item">
                <div class="why-icon">&#x26A1;</div>
                <div class="why-title">High Yield</div>
                <div class="why-desc">Earn USDT rewards on your staked LP position</div>
            </div>
            <div class="why-item">
                <div class="why-icon">&#x1F3AF;</div>
                <div class="why-title">Asset-Backed</div>
                <div class="why-desc">TCu29 is backed by real physical copper</div>
            </div>
            <div class="why-item">
                <div class="why-icon">&#x1F512;</div>
                <div class="why-title">Verified</div>
                <div class="why-desc">Contract verified on BSCScan</div>
            </div>
            <div class="why-item">
                <div class="why-icon">&#x1F4CA;</div>
                <div class="why-title">Transparent</div>
                <div class="why-desc">On-chain reserves, quarterly audits</div>
            </div>
        </div>

        <div id="connect-section" class="card" style="margin-top: 16px;">
            <div class="connect-prompt">
                <p>Connect your wallet to stake TCu29/USDT LP tokens</p>
                <button class="btn btn-primary" id="connect-btn">Connect Wallet</button>
            </div>
        </div>

        <div id="stake-section" class="card hidden" style="margin-top: 16px;">
            <div id="status-msg" class="status hidden"></div>

            <div class="pending-rewards">
                <div class="pending-value" id="pending-rewards">0.0000 USDT</div>
                <div class="pending-label">Pending Rewards</div>
            </div>
            <button class="btn btn-primary" id="harvest-btn">Harvest Rewards</button>

            <h3 class="section-title">Your Position</h3>
            <div class="stats-grid">
                <div class="stat">
                    <div class="stat-value" id="user-staked">0.00</div>
                    <div class="stat-label">LP Staked</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="user-share">0.00%</div>
                    <div class="stat-label">Pool Share</div>
                </div>
            </div>

            <h3 class="section-title">Stake LP Tokens</h3>
            <div class="input-group">
                <div class="input-wrapper">
                    <input type="number" id="deposit-amount" placeholder="0.0" step="any">
                    <button class="max-btn" id="deposit-max-btn">MAX</button>
                </div>
                <div class="balance-row">
                    <span>Balance:</span>
                    <span id="lp-balance">0.00 LP</span>
                </div>
            </div>
            <button class="btn btn-primary" id="deposit-btn">Deposit</button>

            <h3 class="section-title">Withdraw LP Tokens</h3>
            <div class="input-group">
                <div class="input-wrapper">
                    <input type="number" id="withdraw-amount" placeholder="0.0" step="any">
                    <button class="max-btn" id="withdraw-max-btn">MAX</button>
                </div>
                <div class="balance-row">
                    <span>Staked:</span>
                    <span id="staked-balance">0.00 LP</span>
                </div>
            </div>
            <button class="btn btn-secondary" id="withdraw-btn">Withdraw</button>
        </div>

        <div class="links">
            <a href="https://pancakeswap.finance/add/0x5b0B5c848a843c83c20dcfa25CDe6E122898a614/0x55d398326f99059fF775485246999027B3197955" target="_blank">Get LP Tokens</a>
            <a href="https://bscscan.com/address/0x7Fe0EDcCd50A704D78EdA999607CA9B61BCafD0A#code" target="_blank">Contract</a>
            <a href="https://dexscreener.com/bsc/0xc4a13d9c061bb6fc254cc31d4737c6d5427b3aa8" target="_blank">Chart</a>
        </div>

        <div class="footer">
            <a href="https://tcu29.io" target="_blank">Learn more at TCu29.io</a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/ethers@6/dist/ethers.umd.min.js"></script>
    <script>
        // Contract addresses
        const FARM_ADDRESS = "0x7Fe0EDcCd50A704D78EdA999607CA9B61BCafD0A";
        const LP_TOKEN_ADDRESS = "0xC4A13D9C061bb6FC254cc31d4737C6d5427B3aa8";
        const USDT_ADDRESS = "0x55d398326f99059fF775485246999027B3197955";
        const PRICE_ORACLE_ADDRESS = "0x0F7b4081E023d5962A7CeA0C3530D5deb016779e";

        // ABIs
        const PRICE_ORACLE_ABI = [
            "function getPrice() view returns (uint256)",
            "function getLastUpdateTime() view returns (uint256)"
        ];

        const FARM_ABI = [
            "function deposit(uint256 pid, uint256 amount) external",
            "function withdraw(uint256 pid, uint256 amount) external",
            "function harvest(uint256 pid) external",
            "function pendingReward(uint256 pid, address user) view returns (uint256)",
            "function userInfo(uint256 pid, address user) view returns (uint256 amount, uint256 rewardDebt)",
            "function getFarmInfo() view returns (uint256 totalStaked, uint256 rewardsPerDay, uint256 rewardsRemaining, uint256 endTime)",
            "function rewardPerSecond() view returns (uint256)"
        ];

        const ERC20_ABI = [
            "function balanceOf(address account) view returns (uint256)",
            "function approve(address spender, uint256 amount) returns (bool)",
            "function allowance(address owner, address spender) view returns (uint256)"
        ];

        const LP_ABI = [
            ...ERC20_ABI,
            "function totalSupply() view returns (uint256)"
        ];

        // State
        let provider, signer, userAddress;
        let farm, lpToken, usdt;

        // DOM elements
        const connectBtn = document.getElementById('connect-btn');
        const connectSection = document.getElementById('connect-section');
        const stakeSection = document.getElementById('stake-section');
        const statusMsg = document.getElementById('status-msg');

        // Initialize
        async function init() {
            await Promise.all([
                updateFarmStats(),
                updateCopperPrice()
            ]);
            setInterval(updateFarmStats, 30000);
            setInterval(updateCopperPrice, 60000);
        }

        // Update copper price from oracle
        async function updateCopperPrice() {
            try {
                const readProvider = new ethers.JsonRpcProvider('https://bsc-dataseed.binance.org/');
                const priceOracle = new ethers.Contract(PRICE_ORACLE_ADDRESS, PRICE_ORACLE_ABI, readProvider);

                const price = await priceOracle.getPrice();
                const priceFormatted = parseFloat(ethers.formatUnits(price, 18)).toFixed(2);

                document.getElementById('copper-price').textContent = '$' + priceFormatted;
            } catch (error) {
                console.error('Failed to fetch copper price:', error);
            }
        }

        // Connect wallet
        connectBtn.addEventListener('click', async () => {
            try {
                if (!window.ethereum) {
                    showStatus('Please install MetaMask or another Web3 wallet', 'error');
                    return;
                }

                provider = new ethers.BrowserProvider(window.ethereum);

                // Request account access
                await provider.send("eth_requestAccounts", []);

                // Check network (BSC = 56)
                const network = await provider.getNetwork();
                if (network.chainId !== 56n) {
                    try {
                        await window.ethereum.request({
                            method: 'wallet_switchEthereumChain',
                            params: [{ chainId: '0x38' }],
                        });
                        provider = new ethers.BrowserProvider(window.ethereum);
                    } catch (switchError) {
                        showStatus('Please switch to BSC network', 'error');
                        return;
                    }
                }

                signer = await provider.getSigner();
                userAddress = await signer.getAddress();

                // Initialize contracts
                farm = new ethers.Contract(FARM_ADDRESS, FARM_ABI, signer);
                lpToken = new ethers.Contract(LP_TOKEN_ADDRESS, LP_ABI, signer);
                usdt = new ethers.Contract(USDT_ADDRESS, ERC20_ABI, signer);

                // Update UI
                connectSection.classList.add('hidden');
                stakeSection.classList.remove('hidden');

                await updateUserInfo();
                setInterval(updateUserInfo, 10000);

            } catch (error) {
                console.error(error);
                showStatus('Failed to connect: ' + error.message, 'error');
            }
        });

        // Update farm statistics
        async function updateFarmStats() {
            try {
                const readProvider = new ethers.JsonRpcProvider('https://bsc-dataseed.binance.org/');
                const farmRead = new ethers.Contract(FARM_ADDRESS, FARM_ABI, readProvider);
                const lpRead = new ethers.Contract(LP_TOKEN_ADDRESS, LP_ABI, readProvider);
                const usdtRead = new ethers.Contract(USDT_ADDRESS, ERC20_ABI, readProvider);

                const [farmInfo, lpSupply, usdtInPool] = await Promise.all([
                    farmRead.getFarmInfo(),
                    lpRead.totalSupply(),
                    usdtRead.balanceOf(LP_TOKEN_ADDRESS)
                ]);

                const [totalStaked, rewardsPerDay] = farmInfo;

                // Calculate LP price (2 * USDT reserve / total supply)
                const poolTVL = usdtInPool * 2n;
                const lpPrice = lpSupply > 0n ? poolTVL * BigInt(1e18) / lpSupply : 0n;

                // Calculate TVL
                const tvl = totalStaked * lpPrice / BigInt(1e18);

                // Calculate APR
                const annualRewards = rewardsPerDay * 365n;
                const apr = tvl > 0n ? (annualRewards * 100n * BigInt(1e18)) / tvl : 0n;

                // Update UI
                document.getElementById('tvl').textContent = '$' + formatNumber(ethers.formatUnits(tvl, 18), 2);
                document.getElementById('apr').textContent = formatNumber(ethers.formatUnits(apr, 18), 0) + '%';

            } catch (error) {
                console.error('Failed to update farm stats:', error);
            }
        }

        // Update user info
        async function updateUserInfo() {
            if (!userAddress) return;

            try {
                const [userInfo, lpBalance, pending, farmInfo] = await Promise.all([
                    farm.userInfo(0, userAddress),
                    lpToken.balanceOf(userAddress),
                    farm.pendingReward(0, userAddress),
                    farm.getFarmInfo()
                ]);

                const [userStaked] = userInfo;
                const [totalStaked] = farmInfo;

                const share = totalStaked > 0n ? (userStaked * 10000n / totalStaked) : 0n;

                document.getElementById('user-staked').textContent = formatNumber(ethers.formatUnits(userStaked, 18), 4);
                document.getElementById('staked-balance').textContent = formatNumber(ethers.formatUnits(userStaked, 18), 4) + ' LP';
                document.getElementById('lp-balance').textContent = formatNumber(ethers.formatUnits(lpBalance, 18), 4) + ' LP';
                document.getElementById('user-share').textContent = (Number(share) / 100).toFixed(2) + '%';
                document.getElementById('pending-rewards').textContent = formatNumber(ethers.formatUnits(pending, 18), 6) + ' USDT';

                // Store for max buttons
                window.userLpBalance = lpBalance;
                window.userStaked = userStaked;

            } catch (error) {
                console.error('Failed to update user info:', error);
            }
        }

        // Deposit
        document.getElementById('deposit-btn').addEventListener('click', async () => {
            const amount = document.getElementById('deposit-amount').value;
            if (!amount || parseFloat(amount) <= 0) {
                showStatus('Enter an amount', 'error');
                return;
            }

            try {
                const amountWei = ethers.parseUnits(amount, 18);

                // Check allowance
                const allowance = await lpToken.allowance(userAddress, FARM_ADDRESS);
                if (allowance < amountWei) {
                    showStatus('Approving LP tokens...', 'pending');
                    const approveTx = await lpToken.approve(FARM_ADDRESS, amountWei);
                    await approveTx.wait();
                }

                showStatus('Depositing...', 'pending');
                const tx = await farm.deposit(0, amountWei);
                await tx.wait();

                showStatus('Deposit successful!', 'success');
                document.getElementById('deposit-amount').value = '';
                await updateUserInfo();
                await updateFarmStats();

            } catch (error) {
                console.error(error);
                showStatus('Deposit failed: ' + (error.reason || error.message), 'error');
            }
        });

        // Withdraw
        document.getElementById('withdraw-btn').addEventListener('click', async () => {
            const amount = document.getElementById('withdraw-amount').value;
            if (!amount || parseFloat(amount) <= 0) {
                showStatus('Enter an amount', 'error');
                return;
            }

            try {
                const amountWei = ethers.parseUnits(amount, 18);

                showStatus('Withdrawing...', 'pending');
                const tx = await farm.withdraw(0, amountWei);
                await tx.wait();

                showStatus('Withdraw successful!', 'success');
                document.getElementById('withdraw-amount').value = '';
                await updateUserInfo();
                await updateFarmStats();

            } catch (error) {
                console.error(error);
                showStatus('Withdraw failed: ' + (error.reason || error.message), 'error');
            }
        });

        // Harvest
        document.getElementById('harvest-btn').addEventListener('click', async () => {
            try {
                showStatus('Harvesting rewards...', 'pending');
                const tx = await farm.harvest(0);
                await tx.wait();

                showStatus('Harvest successful!', 'success');
                await updateUserInfo();

            } catch (error) {
                console.error(error);
                showStatus('Harvest failed: ' + (error.reason || error.message), 'error');
            }
        });

        // Max buttons
        document.getElementById('deposit-max-btn').addEventListener('click', () => {
            if (window.userLpBalance) {
                document.getElementById('deposit-amount').value = ethers.formatUnits(window.userLpBalance, 18);
            }
        });

        document.getElementById('withdraw-max-btn').addEventListener('click', () => {
            if (window.userStaked) {
                document.getElementById('withdraw-amount').value = ethers.formatUnits(window.userStaked, 18);
            }
        });

        // Helpers
        function showStatus(message, type) {
            statusMsg.textContent = message;
            statusMsg.className = 'status ' + type;
            statusMsg.classList.remove('hidden');

            if (type === 'success') {
                setTimeout(() => statusMsg.classList.add('hidden'), 5000);
            }
        }

        function formatNumber(num, decimals) {
            const n = parseFloat(num);
            if (isNaN(n)) return '0';
            if (n >= 1000000) return (n / 1000000).toFixed(2) + 'M';
            if (n >= 1000) return (n / 1000).toFixed(2) + 'K';
            return n.toFixed(decimals);
        }

        // Handle account changes
        if (window.ethereum) {
            window.ethereum.on('accountsChanged', () => window.location.reload());
            window.ethereum.on('chainChanged', () => window.location.reload());
        }

        // Start
        init();
    </script>
</body>
</html>
